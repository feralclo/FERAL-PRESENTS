<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Checkout — FERAL Liverpool | 27 March 2026</title>
  <meta name="robots" content="noindex, nofollow">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      background: #0e0e0e;
      color: #fff;
      min-height: 100vh;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* ========================================
       LOADING INTERSTITIAL
       ======================================== */
    .loading-screen {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: #0e0e0e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s ease;
    }

    .loading-screen--hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-screen__logo {
      width: 140px;
      height: auto;
      margin-bottom: 48px;
      opacity: 0.9;
    }

    .loading-screen__status {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #555;
      margin-bottom: 24px;
    }

    .loading-screen__bar {
      width: 200px;
      height: 2px;
      background: rgba(255, 255, 255, 0.06);
      position: relative;
      overflow: hidden;
    }

    .loading-screen__progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: #f60434;
      transition: width 0.3s ease;
    }

    .loading-screen__detail {
      margin-top: 20px;
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      letter-spacing: 1.5px;
      color: #333;
      text-transform: uppercase;
    }

    /* Subtle scanline on loading screen */
    .loading-screen::after {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.01) 2px,
        rgba(255, 255, 255, 0.01) 4px
      );
      pointer-events: none;
    }

    /* ========================================
       HEADER
       ======================================== */
    .checkout-header {
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      padding: 0 24px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .checkout-header__back {
      position: absolute;
      left: 24px;
      top: 50%;
      transform: translateY(-50%);
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #555;
      text-decoration: none;
      transition: color 0.15s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .checkout-header__back:hover {
      color: #fff;
    }

    .checkout-header__back-arrow {
      font-size: 14px;
      line-height: 1;
    }

    .checkout-header__logo {
      height: 44px;
      width: auto;
      display: block;
    }

    .checkout-header__secure {
      position: absolute;
      right: 24px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 6px;
      font-family: 'Space Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #444;
    }

    .checkout-header__lock {
      width: 11px;
      height: 11px;
      color: #f60434;
    }

    /* ========================================
       COUNTDOWN TIMER
       ======================================== */
    .checkout-timer {
      background: #0e0e0e;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .checkout-timer__label {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #555;
    }

    .checkout-timer__time {
      font-family: 'Space Mono', monospace;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 2px;
      color: #fff;
      min-width: 56px;
    }

    .checkout-timer__bar {
      flex: 1;
      max-width: 120px;
      height: 2px;
      background: rgba(255, 255, 255, 0.06);
      position: relative;
      overflow: hidden;
    }

    .checkout-timer__fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background: #f60434;
      transition: width 1s linear;
      transform-origin: left;
    }

    /* Urgent state: under 2 minutes */
    .checkout-timer--urgent .checkout-timer__time {
      color: #f60434;
    }

    .checkout-timer--urgent .checkout-timer__label {
      color: #f60434;
      animation: timerPulse 1s ease-in-out infinite;
    }

    @keyframes timerPulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    /* Expired state */
    .checkout-timer--expired .checkout-timer__time {
      color: #f60434;
    }

    .checkout-timer--expired .checkout-timer__label {
      color: #f60434;
    }

    /* ========================================
       ORDER SUMMARY STRIP
       ======================================== */
    .checkout-summary {
      background: rgba(246, 4, 52, 0.04);
      border-bottom: 1px solid rgba(246, 4, 52, 0.15);
      padding: 10px 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .checkout-summary__text {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #888;
    }

    .checkout-summary__qty {
      color: #fff;
      font-weight: 700;
    }

    .checkout-summary__price {
      color: #f60434;
      font-weight: 700;
    }

    /* ========================================
       EMBED CONTAINER
       ======================================== */
    #eventix-shop-container {
      background: #1c1c1c;
      width: 100%;
      min-height: calc(100vh - 120px);
      overflow: visible;
    }

    #eventix-shop-container > div,
    #eventix-shop-container > div > div {
      width: 100% !important;
      max-width: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    #eventix-shop-container iframe {
      width: 100% !important;
      max-width: none !important;
      min-width: 100% !important;
      height: 2400px;
      min-height: 2400px;
      border: none !important;
      display: block;
      background: #1c1c1c;
    }


    /* ========================================
       RESPONSIVE
       ======================================== */
    @media (max-width: 600px) {
      .checkout-header {
        height: 64px;
        padding: 0 16px;
      }

      .checkout-header__back {
        left: 16px;
      }

      .checkout-header__logo {
        height: 34px;
      }

      .checkout-header__secure {
        right: 16px;
        font-size: 8px;
        letter-spacing: 1.5px;
        gap: 4px;
      }

      .checkout-header__lock {
        width: 10px;
        height: 10px;
      }

      .checkout-timer {
        padding: 10px 16px;
        gap: 8px;
      }

      .checkout-timer__label {
        font-size: 9px;
        letter-spacing: 1.5px;
      }

      .checkout-timer__time {
        font-size: 13px;
      }

      .checkout-summary {
        padding: 8px 16px;
        flex-wrap: wrap;
        gap: 6px;
      }

      .checkout-summary__text {
        font-size: 9px;
      }

      .loading-screen__logo {
        width: 110px;
      }
    }
  </style>

  <!-- Cookie Consent -->
  <link rel="stylesheet" href="../../../css/style.css">
  <script src="../../../js/cookie-consent.js"></script>
</head>
<body>

  <!-- Loading Interstitial -->
  <div class="loading-screen" id="loadingScreen">
    <img src="../../../images/FERAL%20LOGO.svg" alt="FERAL PRESENTS" class="loading-screen__logo">
    <div class="loading-screen__status" id="loadingStatus">Preparing your tickets</div>
    <div class="loading-screen__bar">
      <div class="loading-screen__progress" id="loadingProgress"></div>
    </div>
    <div class="loading-screen__detail" id="loadingDetail">Connecting to checkout&hellip;</div>
  </div>

  <!-- Header -->
  <div class="checkout-header">
    <a href="/event/liverpool-27-march/" class="checkout-header__back">
      <span class="checkout-header__back-arrow">&larr;</span>
      <span>Back</span>
    </a>
    <a href="/event/liverpool-27-march/">
      <img src="../../../images/FERAL%20LOGO.svg" alt="FERAL PRESENTS" class="checkout-header__logo">
    </a>
    <div class="checkout-header__secure">
      <svg class="checkout-header__lock" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
        <path d="M8 11V7a4 4 0 018 0v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Secure Checkout</span>
    </div>
  </div>

  <!-- Countdown Timer -->
  <div class="checkout-timer" id="checkoutTimer">
    <span class="checkout-timer__label">Reservation expires</span>
    <span class="checkout-timer__time" id="timerDisplay">08:02</span>
    <div class="checkout-timer__bar">
      <div class="checkout-timer__fill" id="timerBar"></div>
    </div>
  </div>

  <!-- Order Summary Strip -->
  <div class="checkout-summary" id="checkoutSummary">
    <span class="checkout-summary__text">
      <span class="checkout-summary__qty" id="summaryQty">1</span> &times; General Release
    </span>
  </div>

  <!-- Embed -->
  <div id="eventix-shop-container"></div>


  <script src="https://v1.widget.shop.eventix.io/injector.js"></script>
  <script>
    (async function() {
      var SHOP_ID = 'ad7b1eab-9c0b-4525-be60-be9c1c523dfe';
      var TICKET_ID = '6b45169f-cf51-4600-8682-d6f79dcb59ae';
      var TIMER_SECONDS = (8 * 60) + 2; // 8 minutes 2 seconds (offset for embed timer)

      var params = new URLSearchParams(window.location.search);
      var qty = parseInt(params.get('qty')) || 1;

      // --- Update order summary ---
      var summaryQty = document.getElementById('summaryQty');
      if (summaryQty) summaryQty.textContent = qty;

      // --- Loading screen ---
      var loadingScreen = document.getElementById('loadingScreen');
      var loadingProgress = document.getElementById('loadingProgress');
      var loadingStatus = document.getElementById('loadingStatus');
      var loadingDetail = document.getElementById('loadingDetail');

      function setLoadingProgress(pct, detail) {
        if (loadingProgress) loadingProgress.style.width = pct + '%';
        if (detail && loadingDetail) loadingDetail.textContent = detail;
      }

      function hideLoadingScreen() {
        if (loadingScreen) loadingScreen.classList.add('loading-screen--hidden');
        // Start countdown timer when checkout becomes visible
        startTimer();
      }

      setLoadingProgress(10, 'Connecting to checkout\u2026');

      // --- 8-minute countdown timer ---
      var timerDisplay = document.getElementById('timerDisplay');
      var timerBar = document.getElementById('timerBar');
      var checkoutTimer = document.getElementById('checkoutTimer');
      var timerStarted = false;
      var timerRemaining = TIMER_SECONDS;

      function formatTime(s) {
        var m = Math.floor(s / 60);
        var sec = s % 60;
        return (m < 10 ? '0' : '') + m + ':' + (sec < 10 ? '0' : '') + sec;
      }

      function startTimer() {
        if (timerStarted) return;
        timerStarted = true;

        var interval = setInterval(function() {
          timerRemaining--;

          if (timerRemaining <= 0) {
            timerRemaining = 0;
            clearInterval(interval);
            if (timerDisplay) timerDisplay.textContent = '00:00';
            if (timerBar) timerBar.style.width = '0%';
            if (checkoutTimer) checkoutTimer.classList.add('checkout-timer--expired');
            return;
          }

          if (timerDisplay) timerDisplay.textContent = formatTime(timerRemaining);
          if (timerBar) timerBar.style.width = ((timerRemaining / TIMER_SECONDS) * 100) + '%';

          // Urgent at 2 minutes
          if (timerRemaining <= 120 && checkoutTimer) {
            checkoutTimer.classList.add('checkout-timer--urgent');
          }
        }, 1000);
      }

      // --- WeeZTix ShopInjector ---
      function getCookie(name) {
        var nameEQ = name + '=';
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) === ' ') c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
      }

      function getPersistedValues() {
        var sessionValue = window.sessionStorage.getItem('@openticket:persist-campaign-data:entries');
        if (sessionValue) return JSON.parse(sessionValue);
        var cookieValue = getCookie('@openticket:persist-campaign-data:entries');
        if (cookieValue) return JSON.parse(cookieValue);
        return {};
      }

      function waitForOpenTicket() {
        return new Promise(function(resolve) {
          function check() {
            if (window.OpenTicket && window.OpenTicket.ShopInjector) {
              resolve();
            } else {
              setTimeout(check, 200);
            }
          }
          check();
        });
      }

      setLoadingProgress(25, 'Loading payment system\u2026');
      await waitForOpenTicket();
      setLoadingProgress(40, 'Initialising shop\u2026');

      var config = {
        url: 'https://shop.weeztix.com/' + SHOP_ID,
        guid: SHOP_ID,
        container: 'eventix-shop-container',
        cookiePreferences: {
          functional: true,
          analytical: true,
          organiserMarketing: true,
          embeddedContent: true
        }
      };

      var persistedValues = getPersistedValues();
      if (Object.keys(persistedValues).length !== 0) {
        config.trackingInfo = persistedValues;
      }

      window.ShopInjector = new window.OpenTicket.ShopInjector();
      await window.ShopInjector.init(config);

      setLoadingProgress(60, 'Adding ' + qty + (qty === 1 ? ' ticket' : ' tickets') + ' to cart\u2026');
      if (loadingStatus) loadingStatus.textContent = 'Securing your tickets';

      // Resize iframe — use content height from embed if available, otherwise stay large
      var container = document.getElementById('eventix-shop-container');
      var observer = new MutationObserver(function() {
        var iframe = container.querySelector('iframe');
        if (iframe) {
          // Listen for the embed reporting its actual content height
          window.addEventListener('message', function(e) {
            if (e.data && typeof e.data.height === 'number') {
              // Use reported height but never shrink below 2400px
              var h = Math.max(2400, e.data.height + 100);
              iframe.style.height = h + 'px';
              iframe.style.minHeight = h + 'px';
            }
          });

          observer.disconnect();
        }
      });
      observer.observe(container, { childList: true, subtree: true });

      // Add tickets sequentially with cart confirmation
      var ticketsAdded = 0;
      var expectedCount = 0;

      function addNextTicket() {
        if (ticketsAdded >= qty) return;
        window.ShopInjector.shop.sendMessage({
          action: 'add',
          guid: TICKET_ID,
          type: 'ticket'
        });
      }

      window.ShopInjector.shop.onCartData(function(data) {
        if (ticketsAdded >= qty) return;

        var currentCount = 0;
        if (data && data.tickets && data.tickets[TICKET_ID]) {
          currentCount = data.tickets[TICKET_ID].count || 0;
        }

        if (currentCount > expectedCount) {
          expectedCount = currentCount;
          ticketsAdded = currentCount;

          // Update loading progress
          var pct = 60 + Math.round((ticketsAdded / qty) * 35);
          setLoadingProgress(pct, 'Added ' + ticketsAdded + ' of ' + qty + (qty === 1 ? ' ticket' : ' tickets'));

          if (ticketsAdded >= qty) {
            // All tickets added — show checkout
            setLoadingProgress(100, 'Ready');
            if (loadingStatus) loadingStatus.textContent = 'All set';
            setTimeout(hideLoadingScreen, 400);
          } else {
            setTimeout(addNextTicket, 150);
          }
        }
      });

      // Also hide loading if embed loads before tickets are confirmed
      var embedReady = false;
      window.ShopInjector.shop.onCartData(function() {
        if (!embedReady) {
          embedReady = true;
          // If qty is 0 or loading is taking too long, hide after a timeout
        }
      });

      // Fallback: hide loading screen after 12s no matter what
      setTimeout(function() {
        if (!loadingScreen.classList.contains('loading-screen--hidden')) {
          setLoadingProgress(100, 'Ready');
          setTimeout(hideLoadingScreen, 300);
        }
      }, 12000);

      // Start adding tickets
      setTimeout(function() {
        addNextTicket();
      }, 500);
    })();
  </script>
</body>
</html>
