<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FERAL Liverpool — Invisible Wind Factory | 27 March 2026 | Techno Rave</title>
  <meta name="description" content="FERAL takes over Invisible Wind Factory Liverpool on 27 March 2026. Hard techno, industrial and hardstyle. Full 360° setup with immersive production. Tickets on sale now.">
  <meta name="keywords" content="Liverpool rave, Invisible Wind Factory, techno event Liverpool, hard techno, hardstyle, industrial techno, FERAL Liverpool, warehouse rave">

  <!-- Open Graph / Social Sharing -->
  <meta property="og:type" content="event">
  <meta property="og:title" content="FERAL Liverpool — Invisible Wind Factory | 27 March">
  <meta property="og:description" content="FERAL takes over Invisible Wind Factory on 27 March. Hard techno, industrial and hardstyle. Full 360° immersive production.">
  <meta property="og:image" content="https://feralpresents.com/images/liverpool-tile.jpg">
  <meta property="og:url" content="https://feralpresents.com/event/liverpool-27-march/">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="FERAL Liverpool — Invisible Wind Factory | 27 March">
  <meta name="twitter:description" content="Hard techno, industrial and hardstyle. Full 360° immersive production at Invisible Wind Factory.">
  <meta name="twitter:image" content="https://feralpresents.com/images/liverpool-tile.jpg">

  <link rel="stylesheet" href="../../css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Cookie Consent (must load before GTM) -->
  <script src="../../js/cookie-consent.js"></script>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MPZMXXBD');</script>
  <!-- End Google Tag Manager -->
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MPZMXXBD"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <!-- Scanline overlay -->
  <div class="scanlines" aria-hidden="true"></div>

  <!-- Noise texture overlay -->
  <div class="noise" aria-hidden="true"></div>

  <!-- Navigation -->
  <header class="header" id="header">
    <!-- Official Store Announcement Banner -->
    <div class="announcement-banner">
      <span class="announcement-banner__shield">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L3 7v5c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z" fill="#fff"/>
          <path d="M10 15.5l-3.5-3.5 1.41-1.41L10 12.67l5.59-5.59L17 8.5l-7 7z" fill="#ff0033"/>
        </svg>
      </span>
      <span class="announcement-banner__verified">Official FERAL ticket store</span>
    </div>
    <nav class="nav">
      <a href="/" class="nav__logo">
        <img src="../../images/FERAL%20LOGO.svg" alt="FERAL PRESENTS" class="nav__logo-img">
      </a>
      <button class="nav__toggle" id="navToggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="nav__menu" id="navMenu">
        <ul class="nav__list">
          <li class="nav__item"><a href="/#events" class="nav__link">Events</a></li>
          <li class="nav__item"><a href="/#about" class="nav__link">About</a></li>
          <li class="nav__item"><a href="/#contact" class="nav__link">Contact</a></li>
          <li class="nav__item"><a href="https://www.feralclo.com/" class="nav__link" target="_blank" rel="noopener">Apparel</a></li>
        </ul>
        <a href="#tickets" class="btn btn--primary nav__cta">Book Tickets</a>
      </div>
    </nav>
  </header>

  <!-- Event Page Content -->
  <main class="event-page" id="eventPage">
    <!-- Event Hero -->
    <section class="event-hero">
      <div class="event-hero__bg">
        <img src="../../images/liverpool-event-banner.jpg" alt="LIVERPOOL" class="event-hero__bg-img">
        <div class="event-hero__darken" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 1;"></div>
        <div class="event-hero__scanline"></div>
      </div>
      <div class="container">
        <div class="event-hero__content">
          <div class="event-hero__topbar">
            <div class="event-hero__meta">
              <span class="event-hero__tag">SECOND RELEASE NOW ACTIVE</span>
            </div>
            <a href="/" class="event-hero__back">
              <span>All Events</span>
              <span class="event-hero__back-arrow">&rarr;</span>
            </a>
          </div>

          <h1 class="event-hero__title glitch" data-text="LIVERPOOL">LIVERPOOL</h1>

          <div class="event-hero__details">
            <div class="event-hero__detail">
              <span class="event-hero__detail-label">DATE</span>
              <span class="event-hero__detail-value">27 MARCH 2026</span>
            </div>
            <div class="event-hero__detail">
              <span class="event-hero__detail-label">DOORS</span>
              <span class="event-hero__detail-value">9:30PM — 4:00AM</span>
            </div>
            <div class="event-hero__detail">
              <span class="event-hero__detail-label">LOCATION</span>
              <span class="event-hero__detail-value">Invisible Wind Factory, Liverpool</span>
            </div>
            <div class="event-hero__detail">
              <span class="event-hero__detail-label">AGE</span>
              <span class="event-hero__detail-value">18+</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Event Content -->
    <section class="event-content">
      <div class="container">
        <div class="event-content__grid">
          <!-- Left: Event Info -->
          <div class="event-info" id="eventInfo">
            <div class="event-info__section">
              <h2 class="event-info__heading">About</h2>
              <p class="event-info__text">
                FERAL takes over Invisible Wind Factory on 27 March with a full 360° setup and the most immersive production build the venue has ever seen. A stacked lineup built as a journey - hard bounce into hard techno, descending into industrial, before finally erupting in hardstyle and rawstyle.
              </p>
            </div>

            <div class="event-info__section">
              <h2 class="event-info__heading">Lineup <span class="event-info__az">[A-Z]</span></h2>
              <div class="event-info__lineup">
                <div class="event-info__artist">
                  <span class="event-info__artist-name">DARK MATTER</span>
                </div>
                <div class="event-info__artist">
                  <span class="event-info__artist-name">MIKA HEGGEMAN</span>
                </div>
                <div class="event-info__artist">
                  <span class="event-info__artist-name">NICOLAS JULIAN</span>
                </div>
                <div class="event-info__artist">
                  <span class="event-info__artist-name">SANDY KLETZ</span>
                </div>
                <div class="event-info__artist">
                  <span class="event-info__artist-name">SO JUICE</span>
                </div>
                <div class="event-info__artist">
                  <span class="event-info__artist-name">STEVIE</span>
                </div>
              </div>
            </div>

            <div class="event-info__section">
              <h2 class="event-info__heading">Details</h2>
              <p class="event-info__text">
                This is an 18+ event. Valid photo ID required at the door. No re-entry. The venue operates a zero-tolerance policy. Accessibility info available on request.
              </p>
            </div>
          </div>

          <!-- Right: Ticket Widget -->
          <aside class="event-tickets" id="tickets">
            <div class="event-tickets__box">
              <!-- Mobile Compact Lineup Widget -->
              <div class="lineup-widget">
                <div class="lineup-widget__header">
                  <span class="lineup-widget__label">LINEUP</span>
                  <span class="lineup-widget__az">[A-Z]</span>
                </div>
                <div class="lineup-widget__artists">
                  <span>DARK MATTER</span>
                  <span class="lineup-widget__dot"></span>
                  <span>MIKA HEGGEMAN</span>
                  <span class="lineup-widget__dot"></span>
                  <span>NICOLAS JULIAN</span>
                  <span class="lineup-widget__dot"></span>
                  <span>SANDY KLETZ</span>
                  <span class="lineup-widget__dot"></span>
                  <span>SO JUICE</span>
                  <span class="lineup-widget__dot"></span>
                  <span>STEVIE</span>
                </div>
                <div class="lineup-widget__line"></div>
              </div>

              <h3 class="event-tickets__heading">Get Tickets<span class="text-red">_</span></h3>
              <p class="event-tickets__subtext">Secure your entry. Limited availability.</p>

              <!-- Unified ticket widget: tiers + selector -->
              <div class="event-tickets__embed" id="tickets-embed">
                <div class="feral-tickets" id="feral-tickets">
                  <!-- Tier display -->
                  <div class="feral-tickets__tiers">
                    <div class="feral-tickets__tier feral-tickets__tier--sold">
                      <span class="feral-tickets__tier-name">FIRST RELEASE</span>
                      <span class="feral-tickets__tier-status">SOLD OUT</span>
                    </div>
                    <div class="feral-tickets__tier feral-tickets__tier--active">
                      <span class="feral-tickets__tier-name">GENERAL RELEASE</span>
                      <div class="feral-tickets__tier-pricing">
                        <span class="feral-tickets__tier-price-tag">&pound;26.46</span>
                        <span class="feral-tickets__tier-breakdown">&pound;24.50 + &pound;1.96 BF</span>
                      </div>
                    </div>
                    <div class="feral-tickets__tier feral-tickets__tier--next">
                      <span class="feral-tickets__tier-name">FINAL RELEASE</span>
                      <div class="feral-tickets__tier-pricing">
                        <span class="feral-tickets__tier-price-tag">&pound;32.35</span>
                        <span class="feral-tickets__tier-breakdown">&pound;29.95 + &pound;2.40 BF</span>
                      </div>
                    </div>
                  </div>

                  <!-- Progress bar -->
                  <div class="feral-tickets__progress">
                    <div class="feral-tickets__bar">
                      <div class="feral-tickets__fill" style="width: 78%;"></div>
                    </div>
                    <div class="feral-tickets__remaining">
                      <span><span class="feral-tickets__count">22%</span> remaining at this price</span>
                    </div>
                  </div>

                  <!-- Quantity selector -->
                  <div class="feral-tickets__row" data-ticket-id="6b45169f-cf51-4600-8682-d6f79dcb59ae">
                    <div class="feral-tickets__controls">
                      <button class="feral-tickets__btn feral-tickets__btn--minus" data-action="remove" data-ticket="6b45169f-cf51-4600-8682-d6f79dcb59ae" aria-label="Remove ticket">&minus;</button>
                      <span class="feral-tickets__qty" id="qty-6b45169f-cf51-4600-8682-d6f79dcb59ae">0</span>
                      <button class="feral-tickets__btn feral-tickets__btn--plus" data-action="add" data-ticket="6b45169f-cf51-4600-8682-d6f79dcb59ae" aria-label="Add ticket">+</button>
                    </div>
                  </div>

                  <!-- Checkout button -->
                  <button class="feral-tickets__checkout" id="checkoutBtn" disabled>Select tickets to continue</button>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </section>
  </main>

  <!-- Fixed Bottom Bar -->
  <div class="bottom-bar" id="bottomBar">
    <div class="bottom-bar__inner">
      <div class="bottom-bar__price">
        <span class="bottom-bar__amount">&pound;26.46</span>
        <span class="bottom-bar__subtitle">Incl. booking fee. No surprises.</span>
      </div>
      <button class="bottom-bar__cta" id="bottomBarCta">Buy Now</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer__inner">
        <span class="footer__copy">&copy; 2026 FERAL PRESENTS. ALL RIGHTS RESERVED.</span>
        <span class="footer__status">STATUS: <span class="text-red">ONLINE</span></span>
      </div>
    </div>
  </footer>

  <script src="../../js/main.js"></script>
  <script>
    // dataLayer initialisation
    window.dataLayer = window.dataLayer || [];

    // Ticket quantity selector + bottom bar
    (function() {
      var TICKET_ID = '6b45169f-cf51-4600-8682-d6f79dcb59ae';
      var TICKET_PRICE_BASE = 24.50;
      var BOOKING_FEE_RATE = 0.08;
      var TICKET_PRICE = Math.round(TICKET_PRICE_BASE * (1 + BOOKING_FEE_RATE) * 100) / 100; // £26.46 incl. BF
      var qty = 0;
      var qtyEl = document.getElementById('qty-' + TICKET_ID);
      var checkoutBtn = document.getElementById('checkoutBtn');
      var bottomBar = document.getElementById('bottomBar');
      var bottomBarCta = document.getElementById('bottomBarCta');
      var bottomBarAmount = bottomBar ? bottomBar.querySelector('.bottom-bar__amount') : null;

      // --- dataLayer: ViewContent on page load ---
      window.dataLayer.push({
        event: 'view_content',
        content_name: 'FERAL Liverpool — 27 March 2026',
        content_ids: [TICKET_ID],
        content_type: 'product',
        value: TICKET_PRICE,
        currency: 'GBP'
      });

      function goToCheckout() {
        if (qty < 1) return;
        // --- dataLayer: InitiateCheckout ---
        window.dataLayer.push({
          event: 'initiate_checkout',
          content_name: 'FERAL Liverpool — 27 March 2026',
          content_ids: [TICKET_ID],
          content_type: 'product',
          value: qty * TICKET_PRICE,
          currency: 'GBP',
          num_items: qty
        });
        document.body.style.transition = 'none';
        document.body.style.opacity = '1';
        window.location.assign('/event/liverpool-27-march/checkout/?qty=' + qty);
      }

      function update() {
        if (qtyEl) qtyEl.textContent = qty;
        // Update checkout button
        if (checkoutBtn) {
          if (qty > 0) {
            checkoutBtn.disabled = false;
            checkoutBtn.textContent = 'Checkout \u2014 \u00A3' + (qty * TICKET_PRICE).toFixed(2);
          } else {
            checkoutBtn.disabled = true;
            checkoutBtn.textContent = 'Select tickets to continue';
          }
        }
        // Update bottom bar
        if (bottomBarAmount) {
          bottomBarAmount.textContent = qty > 0
            ? '\u00A3' + (qty * TICKET_PRICE).toFixed(2)
            : '\u00A3' + TICKET_PRICE.toFixed(2);
        }
        if (bottomBarCta) {
          bottomBarCta.textContent = qty > 0 ? 'Buy ' + qty + (qty === 1 ? ' Ticket' : ' Tickets') : 'Buy Now';
        }
      }

      document.querySelectorAll('.feral-tickets__btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var action = btn.getAttribute('data-action');
          if (action === 'add') {
            qty++;
            // --- dataLayer: AddToCart ---
            window.dataLayer.push({
              event: 'add_to_cart',
              content_name: 'General Release — FERAL Liverpool',
              content_ids: [TICKET_ID],
              content_type: 'product',
              value: TICKET_PRICE,
              currency: 'GBP',
              num_items: qty
            });
          }
          if (action === 'remove' && qty > 0) {
            qty--;
            // --- dataLayer: RemoveFromCart ---
            window.dataLayer.push({
              event: 'remove_from_cart',
              content_name: 'General Release — FERAL Liverpool',
              content_ids: [TICKET_ID],
              content_type: 'product',
              value: TICKET_PRICE,
              currency: 'GBP',
              num_items: qty
            });
          }
          update();
        });
      });

      // Checkout button in ticket widget
      if (checkoutBtn) {
        checkoutBtn.addEventListener('click', function() {
          goToCheckout();
        });
      }

      // Bottom bar CTA: if tickets selected go to checkout, otherwise go to tickets page
      if (bottomBarCta) {
        bottomBarCta.addEventListener('click', function(e) {
          e.stopPropagation();
          if (qty > 0) {
            goToCheckout();
          } else {
            document.body.style.transition = 'none';
            document.body.style.opacity = '1';
            window.location.assign('/event/liverpool-27-march/tickets/');
          }
        });
      }

      update();
    })();
  </script>
  <!-- ============================================
       DISCOUNT POPUP — 3-screen email capture
       ============================================ -->
  <style>
    /* Overlay */
    .dp-overlay {
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.45s ease, visibility 0.45s ease;
    }
    .dp-overlay--visible {
      opacity: 1;
      visibility: visible;
    }

    /* Modal */
    .dp-modal {
      background: #111;
      border: 1px solid rgba(255, 255, 255, 0.08);
      width: 100%;
      max-width: 400px;
      position: relative;
      overflow: hidden;
      transform: translateY(18px) scale(0.97);
      opacity: 0;
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
    }
    .dp-overlay--visible .dp-modal {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    /* Close */
    .dp-close {
      position: absolute;
      top: 12px;
      right: 14px;
      background: none;
      border: none;
      color: #555;
      font-size: 22px;
      cursor: pointer;
      z-index: 2;
      line-height: 1;
      padding: 4px;
      transition: color 0.15s ease;
      touch-action: manipulation;
    }
    .dp-close:hover { color: #fff; }

    /* Content area */
    .dp-body {
      padding: 32px 28px 28px;
      text-align: center;
    }

    /* Logo */
    .dp-logo {
      width: 100px;
      height: auto;
      margin: 0 auto 24px;
      display: block;
      opacity: 0.9;
    }

    /* Headline */
    .dp-headline {
      font-family: 'Space Mono', monospace;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #fff;
      margin-bottom: 8px;
      line-height: 1.3;
    }

    /* Subheadline */
    .dp-sub {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      color: #888;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    /* Buttons row */
    .dp-buttons {
      display: flex;
      gap: 8px;
    }

    .dp-btn {
      flex: 1;
      padding: 13px 10px;
      border: none;
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.15s ease;
      touch-action: manipulation;
      line-height: 1.3;
    }

    .dp-btn--primary {
      background: #ff0033;
      color: #fff;
    }
    .dp-btn--primary:hover { background: #e6002e; }

    .dp-btn--secondary {
      background: transparent;
      color: rgba(255, 255, 255, 0.5);
      border: 1px solid #333;
    }
    .dp-btn--secondary:hover { color: rgba(255, 255, 255, 0.7); border-color: #555; }

    /* Email input */
    .dp-input {
      width: 100%;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: #fff;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      padding: 13px 16px;
      margin-bottom: 12px;
      outline: none;
      transition: border-color 0.15s ease;
      text-align: center;
    }
    .dp-input::placeholder { color: #444; }
    .dp-input:focus { border-color: rgba(255, 0, 51, 0.5); }

    /* Timer */
    .dp-timer {
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }

    .dp-timer__label {
      font-family: 'Space Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #555;
      margin-bottom: 4px;
    }

    .dp-timer__time {
      font-family: 'Space Mono', monospace;
      font-size: 22px;
      font-weight: 700;
      color: #ff0033;
      letter-spacing: 3px;
    }

    /* Discount code display */
    .dp-code {
      background: rgba(255, 0, 51, 0.08);
      border: 1px dashed rgba(255, 0, 51, 0.3);
      padding: 14px 20px;
      margin: 16px 0;
      display: inline-block;
    }

    .dp-code__value {
      font-family: 'Space Mono', monospace;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 4px;
      color: #ff0033;
    }

    .dp-note {
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      color: #666;
      line-height: 1.5;
      margin-top: 8px;
    }

    .dp-done-btn {
      width: 100%;
      margin-top: 20px;
    }

    /* Screen management */
    .dp-screen { display: none; }
    .dp-screen--active { display: block; }

    /* Error state */
    .dp-error {
      color: #ff0033;
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      letter-spacing: 1px;
      margin-bottom: 8px;
      display: none;
    }
    .dp-error--visible { display: block; }

    @media (max-width: 480px) {
      .dp-body { padding: 28px 20px 24px; }
      .dp-headline { font-size: 15px; letter-spacing: 1.5px; }
      .dp-sub { font-size: 12px; }
      .dp-btn { font-size: 9px; padding: 12px 6px; letter-spacing: 1px; }
      .dp-logo { width: 80px; margin-bottom: 20px; }
      .dp-timer__time { font-size: 18px; }
      .dp-code__value { font-size: 18px; letter-spacing: 3px; }
    }
  </style>

  <!-- Popup HTML -->
  <div class="dp-overlay" id="dpOverlay">
    <div class="dp-modal">
      <button class="dp-close" id="dpClose" aria-label="Close">&times;</button>

      <!-- Screen 1: Micro-commitment -->
      <div class="dp-screen dp-screen--active" id="dpScreen1">
        <div class="dp-body">
          <img src="../../images/FERAL%20LOGO.svg" alt="FERAL" class="dp-logo">
          <h2 class="dp-headline">Unlock Feral Raver Discount</h2>
          <p class="dp-sub">Save it before it's gone</p>
          <div class="dp-buttons">
            <button class="dp-btn dp-btn--primary" id="dpYes">Save My Discount</button>
            <button class="dp-btn dp-btn--secondary" id="dpNo">Nah, I'll Pay Full Price</button>
          </div>
          <div class="dp-timer">
            <div class="dp-timer__label">Expires in</div>
            <div class="dp-timer__time" id="dpTimer">04:59</div>
          </div>
        </div>
      </div>

      <!-- Screen 2: Email capture -->
      <div class="dp-screen" id="dpScreen2">
        <div class="dp-body">
          <img src="../../images/FERAL%20LOGO.svg" alt="FERAL" class="dp-logo">
          <h2 class="dp-headline">Unlock Feral Raver Discount</h2>
          <p class="dp-sub">Enter your email to get the code</p>
          <div class="dp-error" id="dpError">Please enter a valid email</div>
          <form id="dpForm">
            <input type="email" class="dp-input" id="dpEmail" placeholder="Enter your email" required autocomplete="email">
            <button type="submit" class="dp-btn dp-btn--primary" style="width:100%">Get My Discount</button>
          </form>
          <div class="dp-timer">
            <div class="dp-timer__label">Expires in</div>
            <div class="dp-timer__time" id="dpTimer2">04:59</div>
          </div>
        </div>
      </div>

      <!-- Screen 3: Discount code reveal -->
      <div class="dp-screen" id="dpScreen3">
        <div class="dp-body">
          <img src="../../images/FERAL%20LOGO.svg" alt="FERAL" class="dp-logo">
          <h2 class="dp-headline">You're In</h2>
          <p class="dp-sub">Here's your exclusive discount code. Use it at checkout.</p>
          <div class="dp-code">
            <span class="dp-code__value">FERALRAVER10</span>
          </div>
          <p class="dp-note">Save this code now — it won't be shown again.</p>
          <button class="dp-btn dp-btn--primary dp-done-btn" id="dpDone">Got It, Let's Go</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup JavaScript -->
  <script>
    (function() {
      var KLAVIYO_LIST_ID = 'SnE86f';
      var POPUP_KEY = 'feral_dp_shown';
      var TIMER_TOTAL = 299; // 4:59

      // Don't show if dismissed/completed within last 30 days
      var lastShown = localStorage.getItem(POPUP_KEY);
      if (lastShown && (Date.now() - parseInt(lastShown, 10)) < 30 * 24 * 60 * 60 * 1000) return;

      var overlay = document.getElementById('dpOverlay');
      var screen1 = document.getElementById('dpScreen1');
      var screen2 = document.getElementById('dpScreen2');
      var screen3 = document.getElementById('dpScreen3');
      var timerEl1 = document.getElementById('dpTimer');
      var timerEl2 = document.getElementById('dpTimer2');
      var remaining = TIMER_TOTAL;
      var timerInterval = null;

      function formatTime(s) {
        var m = Math.floor(s / 60);
        var sec = s % 60;
        return (m < 10 ? '0' : '') + m + ':' + (sec < 10 ? '0' : '') + sec;
      }

      function startTimer() {
        timerInterval = setInterval(function() {
          remaining--;
          if (remaining <= 0) {
            remaining = 0;
            clearInterval(timerInterval);
          }
          var t = formatTime(remaining);
          timerEl1.textContent = t;
          timerEl2.textContent = t;
        }, 1000);
      }

      function showPopup() {
        overlay.classList.add('dp-overlay--visible');
        document.body.style.overflow = 'hidden';
        startTimer();
      }

      function hidePopup() {
        overlay.classList.remove('dp-overlay--visible');
        document.body.style.overflow = '';
        clearInterval(timerInterval);
        localStorage.setItem(POPUP_KEY, Date.now().toString());
      }

      function goToScreen(screen) {
        screen1.classList.remove('dp-screen--active');
        screen2.classList.remove('dp-screen--active');
        screen3.classList.remove('dp-screen--active');
        screen.classList.add('dp-screen--active');
      }

      // Triggers — ANY one fires the popup (first wins)
      // This is a short page so scroll % fires fast. Strategy:
      //   Desktop: exit intent (primary), 20s delay (fallback)
      //            — no scroll trigger (page is ~1.5 viewports tall, scroll % is unreliable)
      //   Mobile:  15s delay or 50% scroll (whichever first)
      //            — no exit intent (unreliable on mobile)
      var shown = false;
      var isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);

      function tryShow() {
        if (shown) return;
        shown = true;
        showPopup();
      }

      if (isMobile) {
        // Mobile: 15s delay
        setTimeout(tryShow, 15000);
        // Mobile: 50% scroll (pages are taller relative to viewport on mobile)
        window.addEventListener('scroll', function() {
          if (shown) return;
          var scrollPct = window.scrollY / (document.documentElement.scrollHeight - window.innerHeight);
          if (scrollPct >= 0.50) tryShow();
        });
      } else {
        // Desktop: exit intent — mouse leaves viewport at top
        document.addEventListener('mouseout', function(e) {
          if (shown) return;
          if (e.clientY <= 0 && e.relatedTarget === null) tryShow();
        });
        // Desktop: 20s fallback if user hasn't triggered exit intent
        setTimeout(tryShow, 20000);
      }

      // Close button
      document.getElementById('dpClose').addEventListener('click', hidePopup);

      // Click overlay to close
      overlay.addEventListener('click', function(e) {
        if (e.target === overlay) hidePopup();
      });

      // Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') hidePopup();
      });

      // Screen 1: "Save My Discount"
      document.getElementById('dpYes').addEventListener('click', function() {
        goToScreen(screen2);
        setTimeout(function() {
          document.getElementById('dpEmail').focus();
        }, 100);
      });

      // Screen 1: "Nah, I'll Pay Full Price"
      document.getElementById('dpNo').addEventListener('click', hidePopup);

      // Screen 2: Email form submit
      document.getElementById('dpForm').addEventListener('submit', function(e) {
        e.preventDefault();
        var email = document.getElementById('dpEmail').value.trim();
        var errorEl = document.getElementById('dpError');

        if (!email || email.indexOf('@') === -1 || email.indexOf('.') === -1) {
          errorEl.classList.add('dp-error--visible');
          return;
        }
        errorEl.classList.remove('dp-error--visible');

        // Subscribe to Klaviyo
        var formData = new FormData();
        formData.append('g', KLAVIYO_LIST_ID);
        formData.append('email', email);
        fetch('https://manage.kmail-lists.com/ajax/subscriptions/subscribe', {
          method: 'POST',
          body: formData
        }).catch(function() {});

        // Identify in Klaviyo if SDK loaded
        if (window._learnq) {
          window._learnq.push(['identify', { '$email': email }]);
          window._learnq.push(['track', 'Discount Popup Signup', {
            'Event': 'FERAL Liverpool — 27 March 2026',
            'Source': 'Discount Popup',
            'Code': 'FERALRAVER10'
          }]);
        }

        // Show code screen
        goToScreen(screen3);
        clearInterval(timerInterval);
        localStorage.setItem(POPUP_KEY, Date.now().toString());
      });

      // Screen 3: "Got It" button
      document.getElementById('dpDone').addEventListener('click', function() {
        hidePopup();
      });
    })();
  </script>

  <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
